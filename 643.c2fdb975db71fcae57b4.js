(self.webpackChunkEasyST=self.webpackChunkEasyST||[]).push([[643],{643:(t,e,i)=>{"use strict";i.r(e),i.d(e,{MapaPageModule:()=>y});var o=i(6274),s=i(4988),n=i(8620),a=i(1626),r=i(1855),c=i(6334),l=i(4480),d=i(2741),u=i(2823),h=i(6849),p=i(8903),m=i(3429);const g=["mapElement"],f=[{path:"",component:(()=>{class t{constructor(t,e,i,o,s,n){this.fb=t,this.alertController=e,this.geolocation=i,this.router=o,this.alertasSvc=s,this.loadingSvc=n,this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,this.db=(0,c.N8)(),this.auth=(0,l.v0)(),this.Taxis=[],this.currentLocation={lat:0,lng:0},this.taxiLocation={lat:21.146452,lng:-86.821208,tiempo:"",distancia:0},this.uid=this.auth.currentUser.uid,this.getServicio(),this.createDirectionForm()}getServicio(){const t=(0,c.iH)(this.db,"Usuarios/"+this.uid+"/Servicios");(0,c.jM)(t,t=>{t.forEach(t=>{"En ruta"===t.val().estatus&&(console.log("si"),window.location.href="/ruta-mapa"),console.log("no")})})}createDirectionForm(){this.directionForm=this.fb.group({destination:["",s.kI.required]})}ngAfterViewInit(){this.map=new google.maps.Map(this.mapNativeElement.nativeElement,{zoom:12,center:{lat:21.16178,lng:-86.851497}}),this.directionsDisplay.setMap(this.map),this.geolocation.getCurrentPosition().then(t=>{this.currentLocation.lat=t.coords.latitude,this.currentLocation.lng=t.coords.longitude,new google.maps.Marker({position:this.currentLocation,map:this.map,title:"Hello World!",icon:{url:"assets/icon/marcador.png",scaledSize:new google.maps.Size(40,40)}})}),this.marcadoresTaxistas()}calculateAndDisplayRoute(t){const e=this;this.directionsService.route({origin:this.currentLocation,destination:t.destination,travelMode:"DRIVING",drivingOptions:{departureTime:new Date(Date.now()),trafficModel:"optimistic"},unitSystem:google.maps.UnitSystem.METRIC},(t,i)=>{"OK"===i?(this.datosRuta=t.routes[0].legs[0],console.log(t),e.directionsDisplay.setDirections(t),this.km=t,this.km2=this.km.routes[0].legs[0].distance.value,this.presentAlert()):this.alertasSvc.notFound(i)})}presentAlert(){return(0,r.mG)(this,void 0,void 0,function*(){this.loadingSvc.cargandoRuta(),yield new Promise(t=>setTimeout(()=>t(),1e3)),this.tarifa=this.km2/1e3*32.5;const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Tarifa asignada",subHeader:"La tarifa de la ruta por "+this.km2/1e3+"km es",message:"Precio estimado $"+parseFloat(this.tarifa).toFixed(2)+" pesos",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",role:"Okay",handler:()=>{this.newService(),window.location.href="/select-taxi/"+this.uid,console.log("Confirm Okay")}}]});yield t.present();const{role:e}=yield t.onDidDismiss();console.log("onDidDismiss resolved with role",e)})}marcadoresTaxistas(){return(0,r.mG)(this,void 0,void 0,function*(){try{const t=(0,c.iH)(this.db,"Taxistas/");(0,c.jM)(t,t=>{this.Taxis=[],t.forEach(t=>{const e=t.val();this.Taxis.push(e);const i={lat:e.lat,lng:e.lng},o={url:"assets/icon/u.png",scaledSize:new google.maps.Size(50,50)};new google.maps.Marker({position:i,map:this.map,title:e.displayName,icon:o})})})}catch(t){console.log("Error->",t)}})}newService(){const t=(0,c.iH)(this.db,"Usuarios/"+this.uid+"/Servicios/preview");(0,c.t8)(t,{distanciaV:this.datosRuta.distance.value,distanciaT:this.datosRuta.distance.text,tiempoV:this.datosRuta.duration.value,tiempoT:this.datosRuta.duration.text,precio:parseFloat(this.tarifa).toFixed(2),destino:this.datosRuta.end_address,ubiClient:this.currentLocation})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(s.qu),d.Y36(n.Br),d.Y36(u.b),d.Y36(a.F0),d.Y36(h.e),d.Y36(p.b))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-mapa"]],viewQuery:function(t,e){if(1&t&&d.Gf(g,5),2&t){let t;d.iGM(t=d.CRH())&&(e.mapNativeElement=t.first)}},decls:9,vars:3,consts:[["titulo","MAPA"],[3,"fullscreen"],[3,"formGroup","ngSubmit"],["placeholder","Destino","formControlName","destination","autocomplete","on"],["expand","full","type","submit",3,"disabled"],[1,"map"],["mapElement",""]],template:function(t,e){1&t&&(d._UZ(0,"app-menu",0),d.TgZ(1,"ion-content",1),d.TgZ(2,"form",2),d.NdJ("ngSubmit",function(){return e.calculateAndDisplayRoute(e.directionForm.value)}),d.TgZ(3,"ion-item"),d._UZ(4,"ion-input",3),d.qZA(),d.TgZ(5,"ion-button",4),d._uU(6,"Generar Ruta "),d.qZA(),d.qZA(),d._UZ(7,"div",5,6),d.qZA()),2&t&&(d.xp6(1),d.Q6J("fullscreen",!0),d.xp6(1),d.Q6J("formGroup",e.directionForm),d.xp6(3),d.Q6J("disabled",e.directionForm.invalid))},directives:[m.M,n.W2,s._Y,s.JL,s.sg,n.Ie,n.pK,n.j9,s.JJ,s.u,n.YG],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}#mapa-mapbox[_ngcontent-%COMP%]{width:100vw;height:100vh;background-color:#ff0}"]}),t})()}];let v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[a.Bz.forChild(f)],a.Bz]}),t})();var w=i(9258);let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({providers:[u.b],imports:[[o.ez,s.u5,n.Pc,v,s.UX,w.K]]}),t})()}}]);