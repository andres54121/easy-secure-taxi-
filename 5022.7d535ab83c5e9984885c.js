(self.webpackChunkEasyST=self.webpackChunkEasyST||[]).push([[5022],{5022:(t,i,e)=>{"use strict";e.r(i),e.d(i,{SelectTaxiPageModule:()=>x});var o=e(6274),a=e(4988),s=e(8620),n=e(1626),r=e(1855),c=e(4480),l=e(6334),u=e(2741),d=e(8903),h=e(2823),p=e(3429);const m=["mapElement"];function g(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"ion-card"),u.TgZ(1,"ion-item"),u.TgZ(2,"ion-avatar",6),u._UZ(3,"img",7),u.qZA(),u.TgZ(4,"h2"),u._uU(5),u.qZA(),u.qZA(),u.TgZ(6,"ion-list"),u.TgZ(7,"ion-item"),u.TgZ(8,"ion-label"),u._uU(9),u.qZA(),u.qZA(),u.TgZ(10,"ion-item"),u.TgZ(11,"ion-label"),u._uU(12),u.qZA(),u.qZA(),u.TgZ(13,"ion-item"),u.TgZ(14,"ion-label"),u._uU(15),u.qZA(),u.qZA(),u.qZA(),u.TgZ(16,"ion-row"),u.TgZ(17,"ion-col"),u.TgZ(18,"ion-button",4),u.NdJ("click",function(){const i=u.CHM(t).$implicit;return u.oxw().dibujarRuta(i.rutaT)}),u._uU(19," Ver ruta "),u.qZA(),u.TgZ(20,"ion-button",8),u.NdJ("click",function(){const i=u.CHM(t).$implicit;return u.oxw().newService(i)}),u._uU(21," Empezar ruta con este taxista "),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=i.$implicit,e=u.oxw();u.xp6(3),u.s9C("src",t.photoURL,u.LSH),u.xp6(2),u.hij(" ",t.displayName,""),u.xp6(4),u.hij("Distancia hasta su ubicaci\xf3n: ",t.distancia.text,""),u.xp6(3),u.hij("Tiempo de llegada a su ubicacion: ",t.tiempo.text,""),u.xp6(3),u.hij("Tiempo total hasta su destino: ",e.formatoTiempo(t)," min")}}const v=[{path:"",component:(()=>{class t{constructor(t,i,e,o){this.loadingSvc=t,this.geolocation=i,this.router=e,this.route=o,this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,this.datosRutaC={},this.currentLocation={lat:0,lng:0},this.taxiLocation={lat:21.146452,lng:-86.821208,tiempo:"",distancia:0},this.taxis=[],this.taxisOrd=[],this.db=(0,l.N8)(),this.refBD=(0,l.iH)(this.db,"Taxistas"),this.uid=this.route.snapshot.paramMap.get("uid"),this.getServicio()}getServicio(){const t=(0,l.iH)(this.db,"Usuarios/"+this.uid+"/Servicios");(0,l.jM)(t,t=>{t.forEach(t=>{"En ruta"===t.val().estatus&&(console.log("si"),this.router.navigate(["ruta-mapa"]),window.location.href="/ruta-mapa"),console.log("no")})})}getPreview(){return(0,r.mG)(this,void 0,void 0,function*(){const t=(0,l.iH)(this.db,"Usuarios/"+this.uid+"/Servicios/preview");yield(0,l.U2)(t).then(t=>{t.exists()?this.datosRutaC=t.val():console.log("No data available")}).catch(t=>{console.error(t)})})}ngAfterViewInit(){this.map=new google.maps.Map(this.mapNativeElement.nativeElement,{zoom:12,center:{lat:21.16178,lng:-86.851497}}),this.directionsDisplay.setMap(this.map),this.geolocation.getCurrentPosition().then(t=>{this.currentLocation.lat=t.coords.latitude,this.currentLocation.lng=t.coords.longitude}),this.taxistaDispo(),this.getPreview(),this.verRuta()}newService(t){const i=(0,c.v0)();this.uid=i.currentUser.uid;const e=(0,l.iH)(this.db,"Usuarios/"+this.uid+"/Servicios/"),o=(0,l.VF)(e);(0,l.t8)(o,{distanciaRuta:{value:this.datosRutaC.distanciaV,text:this.datosRutaC.distanciaT},tiempoRuta:{value:this.datosRutaC.tiempoV,text:this.datosRutaC.tiempoT},precio:this.datosRutaC.precio,destino:this.datosRutaC.destino,ubicCliente:this.currentLocation,ubiTaxi:{lat:t.lat,lng:t.lng},tiempoTaxi:t.tiempo,estatus:"En ruta"});const a=(0,l.iH)(this.db,"/Mensajes/"+this.uid),s=(0,l.VF)(a);(0,l.t8)(s,{mensaje:"Saludos, me estoy dirijiendo a su ubicaci\xf3n",nombre:t.displayName}),this.router.navigate(["ruta-mapa"])}taxistaDispo(){return(0,r.mG)(this,void 0,void 0,function*(){this.loadingSvc.cargando();try{yield(0,l.jM)(this.refBD,t=>{this.taxis=[],t.forEach(t=>{const i=t.val();this.calculateTaxiRoute(i)}),this.ordenar()})}catch(t){console.log("Error->",t)}this.loadingSvc.dismiss(),this.ordenar()})}calculateRoute(t){console.log(t.ubiClient),this.directionsService.route({origin:t.ubiClient,destination:t.destino,travelMode:"DRIVING",drivingOptions:{departureTime:new Date(Date.now()),trafficModel:"optimistic"},unitSystem:google.maps.UnitSystem.METRIC},(t,i)=>{"OK"===i?this.directionsDisplay.setDirections(t):this.taxis=[]})}calculateTaxiRoute(t){this.directionsService.route({origin:t.lat+" "+t.lng,destination:this.currentLocation,travelMode:"DRIVING",drivingOptions:{departureTime:new Date(Date.now()),trafficModel:"optimistic"},unitSystem:google.maps.UnitSystem.METRIC},(i,e)=>{if("OK"===e){const e=i.routes[0].legs[0];this.taxis.push({calificacion:t.calificacion,displayName:t.displayName,lat:t.lat,lng:t.lng,photoURL:t.photoURL,distancia:e.distance,tiempo:e.duration,ord:e.duration.value,rutaT:i})}else this.taxis=[]})}dibujarRuta(t){this.directionsDisplay.setDirections(t)}ordenar(){this.taxisOrd=this.taxis,this.taxisOrd.sort((t,i)=>t.ord>i.ord?1:t.ord<i.ord?-1:0)}verRuta(){return(0,r.mG)(this,void 0,void 0,function*(){yield new Promise(t=>setTimeout(()=>t(),2500)),console.log(this.datosRutaC),this.calculateRoute(this.datosRutaC)})}formatoTiempo(t){return parseFloat(((t.tiempo.value+this.datosRutaC.tiempoV)/60).toString()).toFixed(0)}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(d.b),u.Y36(h.b),u.Y36(n.F0),u.Y36(n.gz))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-select-taxi"]],viewQuery:function(t,i){if(1&t&&u.Gf(m,5),2&t){let t;u.iGM(t=u.CRH())&&(i.mapNativeElement=t.first)}},decls:19,vars:6,consts:[["titulo","Taxista Disponibles"],[3,"scrollEvents"],[1,"mapT"],["mapElement",""],["type","submit","expand","block",3,"click"],[4,"ngFor","ngForOf"],["item-start",""],[3,"src"],["type","submit","expand","block","color","secondary",3,"click"]],template:function(t,i){1&t&&(u._UZ(0,"app-menu",0),u.TgZ(1,"ion-content",1),u._UZ(2,"div",2,3),u.qZA(),u.TgZ(4,"ion-content",1),u.TgZ(5,"ion-card"),u.TgZ(6,"ion-list"),u.TgZ(7,"ion-item"),u.TgZ(8,"ion-label"),u._uU(9),u.qZA(),u.qZA(),u.TgZ(10,"ion-item"),u.TgZ(11,"ion-label"),u._uU(12),u.qZA(),u.qZA(),u.TgZ(13,"ion-item"),u.TgZ(14,"ion-label"),u._uU(15),u.qZA(),u.qZA(),u.TgZ(16,"ion-button",4),u.NdJ("click",function(){return i.ordenar()}),u._uU(17," Ordenar Taxistas "),u.qZA(),u.qZA(),u.qZA(),u.YNc(18,g,22,5,"ion-card",5),u.qZA()),2&t&&(u.xp6(1),u.Q6J("scrollEvents",!1),u.xp6(3),u.Q6J("scrollEvents",!0),u.xp6(5),u.hij("Distancia del viaje: ",i.datosRutaC.distanciaT,""),u.xp6(3),u.hij("Tiempo de llegada: ",i.datosRutaC.tiempoT,""),u.xp6(3),u.hij("Costo Total: $",i.datosRutaC.precio,""),u.xp6(3),u.Q6J("ngForOf",i.taxis))},directives:[p.M,s.W2,s.PM,s.q_,s.Ie,s.Q$,s.YG,o.sg,s.BJ,s.Nd,s.wI],styles:[".mapT[_ngcontent-%COMP%]{width:100%;height:100%}"]}),t})()}];let T=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[n.Bz.forChild(v)],n.Bz]}),t})();var Z=e(9258);let x=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[h.b],imports:[[o.ez,a.u5,s.Pc,T,Z.K]]}),t})()}}]);