(self.webpackChunkEasyST=self.webpackChunkEasyST||[]).push([[7927],{7927:(i,t,e)=>{"use strict";e.r(t),e.d(t,{RutaMapaPageModule:()=>v});var o=e(6274),s=e(4988),n=e(8620),a=e(1626),c=e(6334),r=e(4480),l=e(2741),u=e(2823),p=e(3429);const h=["mapElement"],d=[{path:"",component:(()=>{class i{constructor(i,t,e){this.alertController=i,this.geolocation=t,this.router=e,this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,this.db=(0,c.N8)(),this.auth=(0,r.v0)(),this.uid=this.auth.currentUser.uid,this.servicio={},this.tiempoTaxi={},this.distancia={},this.rutaCompleta={},this.currentLocation={lat:0,lng:0}}ngOnInit(){this.getServicio()}ngAfterViewInit(){this.map=new google.maps.Map(this.mapNativeElement.nativeElement,{zoom:12,center:{lat:21.16178,lng:-86.851497}}),this.directionsDisplay.setMap(this.map),this.geolocation.getCurrentPosition().then(i=>{this.currentLocation.lat=i.coords.latitude,this.currentLocation.lng=i.coords.longitude,new google.maps.Marker({position:this.currentLocation,map:this.map,title:"Hello World!",icon:{url:"assets/icon/marcador.png",scaledSize:new google.maps.Size(40,40)}})})}calculateRoute(i){console.log(i),this.directionsService.route({origin:i.ubiTaxi,destination:i.destino,waypoints:[{location:this.currentLocation,stopover:!1}],travelMode:"DRIVING",drivingOptions:{departureTime:new Date(Date.now()),trafficModel:"optimistic"},unitSystem:google.maps.UnitSystem.METRIC},(i,t)=>{"OK"===t?(this.rutaCompleta=i.routes[0].legs[0],this.directionsDisplay.setDirections(i)):console.log(i)})}getServicio(){this.servicio=[];const i=(0,c.iH)(this.db,"Usuarios/"+this.uid+"/Servicios");(0,c.jM)(i,i=>{i.forEach(i=>{const t=i.val();"En ruta"===t.estatus&&(this.idServicio=i.key,this.servicio=t,this.distancia=this.servicio.distanciaRuta,this.tiempoTaxi=this.servicio.tiempoTaxi,console.log(this.servicio.distanciaRuta.text),this.calculateRoute(t))})},{onlyOnce:!0})}chat(){this.router.navigate(["message"])}cancelServicio(i){const t=(0,c.iH)(this.db,"Usuarios/"+this.uid+"/Servicios/"+i),e=(0,c.iH)(this.db,"/Mensajes/"+this.uid);(0,c.Od)(t),(0,c.Od)(e),this.router.navigate(["mapa"])}}return i.\u0275fac=function(t){return new(t||i)(l.Y36(n.Br),l.Y36(u.b),l.Y36(a.F0))},i.\u0275cmp=l.Xpm({type:i,selectors:[["app-ruta-mapa"]],viewQuery:function(i,t){if(1&i&&l.Gf(h,5),2&i){let i;l.iGM(i=l.CRH())&&(t.mapNativeElement=i.first)}},decls:23,vars:3,consts:[["titulo","En viaje"],[1,"mapT"],["mapElement",""],["type","submit","expand","block",3,"click"],["type","submit","expand","block","color","secondary",3,"click"]],template:function(i,t){1&i&&(l._UZ(0,"app-menu",0),l.TgZ(1,"ion-content"),l._UZ(2,"div",1,2),l.TgZ(4,"ion-card"),l.TgZ(5,"ion-list"),l.TgZ(6,"ion-item"),l.TgZ(7,"ion-label"),l._uU(8),l.qZA(),l.qZA(),l.TgZ(9,"ion-item"),l.TgZ(10,"ion-label"),l._uU(11,"Tiempo de llegada de su taxi a su ubicaci\xf3n "),l._UZ(12,"br"),l._uU(13),l.qZA(),l.qZA(),l.TgZ(14,"ion-item"),l.TgZ(15,"ion-label"),l._uU(16),l.qZA(),l.qZA(),l.qZA(),l.TgZ(17,"ion-row"),l.TgZ(18,"ion-col"),l.TgZ(19,"ion-button",3),l.NdJ("click",function(){return t.chat()}),l._uU(20," Chat "),l.qZA(),l.TgZ(21,"ion-button",4),l.NdJ("click",function(){return t.cancelServicio(t.idServicio)}),l._uU(22," Cancelar Viaje "),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&i&&(l.xp6(8),l.hij("Distancia del viaje: ",t.distancia.text," "),l.xp6(5),l.hij(" ",t.tiempoTaxi.text," "),l.xp6(3),l.hij("Costo Total: $",t.servicio.precio,""))},directives:[p.M,n.W2,n.PM,n.q_,n.Ie,n.Q$,n.Nd,n.wI,n.YG],styles:[".mapT[_ngcontent-%COMP%]{width:100%;height:70%}"]}),i})()}];let m=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=l.oAB({type:i}),i.\u0275inj=l.cJS({imports:[[a.Bz.forChild(d)],a.Bz]}),i})();var g=e(9258);let v=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=l.oAB({type:i}),i.\u0275inj=l.cJS({providers:[u.b],imports:[[o.ez,s.u5,n.Pc,m,g.K]]}),i})()}}]);